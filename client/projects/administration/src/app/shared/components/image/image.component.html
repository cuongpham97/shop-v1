<div  [style.width.px]="controlWidth" class="file-upload">
  <div *ngIf="!src" class="upload-wrap">
    <input class="upload-input" (change)="onSelectImage($event)" type='file' accept="image/*" />
    <div class="drag-text">
      <h3 [style.padding-top.px]="(controlHeight - 33) / 2" [style.padding-bottom.px]="(controlHeight - 33) / 2"><i class="far fa-plus"></i></h3>
    </div>
  </div>
  <div *ngIf="src" class="upload-content">
    <img [style.width.px]="controlWidth" [style.height.px]="controlHeight" [src]="src" class="upload-image"/>
    <button (click)="onRemoveBtnClick()" type="button" class="remove">&times;</button>
  </div>
</div>

<div #modal class="modal fade" tabindex="-1" role="dialog" aria-labelledby="crop-modal"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="crop-modal">Upload Image</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-2">

        <div *ngIf="isDone" class="preview">
          <div class="result">
            <img #preview [src]="croppingImage" >
          </div>
          <div *ngIf="progress > 0" class="progress">
            <div class="progress-bar progress-bar-striped bg-danger" role="progressbar" [style.width.%]="progress" [attr.aria-valuenow]="progress" aria-valuemin="0" aria-valuemax="100">{{progress}}%</div>
          </div>
        </div>
    
        <div class="crop-area">
          <img #cropArea [src]="croppingImage" style="width: 400px; height: 400px; display: none;">
        
          <div *ngIf="!isDone" class="controls">
            <div class="group">
              <button (click)="cropper.setDragMode('move')" class="btn btn-blue"><i class="far fa-arrows"></i></button>
              <button (click)="cropper.setDragMode('crop')" class="btn btn-blue"><i class="far fa-crop"></i></button>
            </div>
          
            <div class="group">
              <button (click)="cropper.zoom(0.1)" class="btn"><i class="far fa-search-plus"></i></button>
              <button (click)="cropper.zoom(-0.1)" class="btn"><i class="far fa-search-minus"></i></button>
              <button (click)="cropper.scaleX(flipX = -flipX)" class="btn"><i class="far fa-arrows-h"></i></button>
              <button (click)="cropper.scaleY(flipY = -flipY)" class="btn"><i class="far fa-arrows-v"></i></button>
            </div>

            <div class="group">
              <button (click)="cropper.move(-10, 0)" class="btn btn-blue"><i class="far fa-arrow-left"></i></button>
              <button (click)="cropper.move(10, 0)" class="btn btn-blue"><i class="far fa-arrow-right"></i></button>
              <button (click)="cropper.move(0, 10)" class="btn btn-blue"><i class="far fa-arrow-up"></i></button>
              <button (click)="cropper.move(0, -10)" class="btn btn-blue"><i class="far fa-arrow-down"></i></button>
            </div>

            <div class="group">
              <button (click)="cropper.setAspectRatio(1)" class="btn btn-blue">1:1</button>
              <button (click)="cropper.setAspectRatio(3/4)" class="btn btn-blue">3:4</button>
              <button (click)="cropper.setAspectRatio(16/9)" class="btn btn-blue">16:9</button>
              <button (click)="cropper.setAspectRatio(0/0)" class="btn btn-blue">Free</button>
            </div>
          
            <div class="group">
              <button (click)="cropper.rotate(-45)" class="btn"><i class="far fa-undo"></i></button>
              <button (click)="cropper.rotate(45)" class="btn"><i class="far fa-redo"></i></button>
            </div>
          
            <div class="group">
              <button (click)="crop()" class="btn btn-green"><i class="far fa-check"></i></button>
              <button (click)="reset()" class="btn btn-blue"><i class="far fa-sync"></i></button>
              <button (click)="cancel()" class="btn btn-red"><i class="far fa-times"></i></button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button *ngIf="!progress" type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancel</button>
        <button *ngIf="isDone && !progress" (click)="onEditBtnClick()" type="button" class="btn btn-sm btn-success">Edit image</button>
        <button *ngIf="isDone && !progress" (click)="onUploadBtnClick()" type="button" class="btn btn-sm btn-danger">Upload and close</button>
      </div>
    </div>
  </div>
</div>
